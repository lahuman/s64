<html>
<head>
<script type="text/javascript">
var toString = (function(){
var base, list, hash, toString, before, replacer, space ;
replacer = {};
space = {};
isContains = function(obj) {
    var i = replacer.length;
    while (i--) {
        if (replacer[i] == obj) {
            return true;
        }
    }
    return false;
};
callReplacer = function(key, val){
	switch(typeof replacer ){
		case "function" :
			return replacer.call(this, key, val);
		case "object" :
				if(isContains[key]){
					return val;
				}else{
					return undefined;
				}
		default :
		return val;
	}
};

before = function(val, key){
	// val = callReplacer(key, val);
	switch(typeof val){
		case "number":
		case "boolean":
		case "object":
			return val;
		case "undefined":
			return undefined;
		default :
		return '"' + val + '"';
	}
	// return callReplacer(key, val);
};
base = function() {
	return before(this);
};
list = function() {
	var i = this.length;
	while(i--){
		if(before(toString(this[i]), i) != undefined)
			this[i] = before(toString(this[i]), i);
	} 
	return '{' + Array.prototype.join.call(this,',') + '}';
};
hash = function() {
	var	result = [], k;
	for(k in this){
        if(this.hasOwnProperty(k)) {
           if(typeof this[k] != 'function'){
           		if(before(toString(this[k]), k) != undefined)
              		result.push((before(k)+':'+before(toString(this[k]), k)));
           }
		   
		}
    }
	return '{' + result.join (',') +'} ';
};
toString = function(val){
	if(arguments[1]){
		replacer = arguments[1];
	}
	if(arguments[2]){
		space = arguments[2];
	}
    var toStr;
	if(val && typeof val == 'object'){
		toStr = 'length' in val ? list : hash;
	}else toStr = base;
    val.toString = function(){
        return toStr.call(this);
    };
	return val;
};
return toString;
})(); 

function replacer(key, value) {
	
  if (typeof value === "string") {
    return undefined;
  }
  return value;
}


console.log(toString([1,'false', [1,"2", false, "false"],false])+'');
console.log(toString({a:123123,"C":[2,"ccc",4], "B":55}, replacer)+'');
console.log(toString("abc")+'');
</script>
</head>
<body>

</body>
</html>
